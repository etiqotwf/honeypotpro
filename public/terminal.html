<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Live Terminal</title>
<style>
  body {
    background: #1e1e1e;
    color: #c5c8c6;
    font-family: monospace;
    margin: 0;
    display: flex;
    flex-direction: column;
    height: 100vh;
  }
  header {
    background: #111;
    padding: 8px;
    display: flex;
    gap: 8px;
  }
  button {
    background: #444;
    color: #fff;
    border: none;
    padding: 6px 12px;
    border-radius: 4px;
    cursor: pointer;
  }
  button:hover { background: #666; }
  #logContainer {
    flex: 1;
    overflow-y: auto;
    padding: 10px;
    white-space: pre-wrap;
  }
</style>
</head>
<body>
<header>
  <button id="startBtn">▶ Start</button>
  <button id="stopBtn">⏸ Stop</button>
  <button id="clearBtn">🗑 Clear</button>
  <button id="copyBtn">📋 Copy</button>
</header>
<div id="logContainer"></div>

<script>
let eventSource = null;
let running = false;
const logContainer = document.getElementById('logContainer');

function appendLine(line) {
  const div = document.createElement('div');
  div.textContent = line;
  logContainer.appendChild(div);
  logContainer.scrollTop = logContainer.scrollHeight;
}

function startSSE() {
  if (running) return;
  eventSource = new EventSource('/events');
  running = true;
  eventSource.addEventListener('line', e => appendLine(JSON.parse(e.data)));
  eventSource.onerror = () => {
    running = false;
    setTimeout(startSSE, 2000);
  };
}

function stopSSE() {
  if (eventSource) eventSource.close();
  running = false;
}

document.getElementById('startBtn').onclick = startSSE;
document.getElementById('stopBtn').onclick = stopSSE;
document.getElementById('clearBtn').onclick = () => logContainer.innerHTML = '';
document.getElementById('copyBtn').onclick = async () => {
  const text = Array.from(logContainer.children).map(d => d.textContent).join('\n');
  await navigator.clipboard.writeText(text);
  alert('✅ Logs copied!');
};

// ابدأ تلقائيًا
startSSE();
</script>
</body>
</html>
